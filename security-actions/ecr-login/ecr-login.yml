name:  ECR Login
description: ECR Login
author: 'Kong'
on:
  workflow_call:
    inputs:
      aws_region:
        description: 'AWS Region for ECR'
        required: true
        type: string
      role_arn:
        description: 'AWS Role to assume for access'
        required: true
        type: string


permissions:
  id-token: write
  contents: read

runs:
  using: 'composite'
  steps:
    # Step 1: Configure AWS Credentials
    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        aws-region: ${{ inputs.aws_region }}
        role-to-assume: ${{ inputs.role_arn }}
        role-session-name: GitHub_to_AWS_via_FederatedOIDC

    # Step 2: Verify AWS Authentication
    - name: Verify AWS Authentication
      run: aws sts get-caller-identity

    # Step 3: Login to Amazon ECR
    - name: Login to Amazon ECR
      uses: aws-actions/amazon-ecr-login@v2
